<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Math Tools | Mr. Smith's Class Resources</title>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Manrope:wght@400;500;600;700&display=swap"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="styles.css" />
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-70DNTY3DTZ"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag("js", new Date());

      gtag("config", "G-70DNTY3DTZ");
    </script>
  </head>
  <body>
    <div class="page-bg" aria-hidden="true"></div>

    <header class="site-header">
      <div class="header-inner brochure-header">
        <p class="eyebrow">Mr. Smith's Class Resources</p>
        <h1>Math Tools</h1>
        <p class="intro">Interactive applets and online tools to support Algebra II, Precalculus, and Calculus.</p>
        <div class="top-links" aria-label="Site navigation">
          <a class="quick-link" href="index.html">Home</a>
          <a class="quick-link" href="algebra-ii-advanced.html">Algebra II Advanced</a>
          <a class="quick-link" href="precalculus-i-cp.html">Precalculus I CP</a>
          <a class="quick-link" href="calculus-honors.html">Calculus Honors</a>
          <a class="quick-link" href="ai-resources.html">AI Resources</a>
          <a class="quick-link" href="math-tools.html">Math Tools</a>
        </div>
        <a class="back-link" href="index.html">Back to Class Resources</a>
      </div>
    </header>

    <main class="content">
      <section class="brochure-grid" aria-label="Math tools">
        <article class="class-card full-width">
          <h2>Triangle Solver (Law of Sines / Law of Cosines)</h2>
          <p class="card-description">
            Enter exactly 3 known values with at least 1 side. Angles are in degrees. This tool also calculates triangle area.
          </p>
          <form id="triangle-solver-form" class="triangle-form">
            <div class="triangle-grid">
              <label for="side-a">Side a</label>
              <input id="side-a" name="a" type="number" step="any" min="0" inputmode="decimal" />

              <label for="side-b">Side b</label>
              <input id="side-b" name="b" type="number" step="any" min="0" inputmode="decimal" />

              <label for="side-c">Side c</label>
              <input id="side-c" name="c" type="number" step="any" min="0" inputmode="decimal" />

              <label for="angle-a">Angle A (deg)</label>
              <input id="angle-a" name="A" type="number" step="any" min="0" max="180" inputmode="decimal" />

              <label for="angle-b">Angle B (deg)</label>
              <input id="angle-b" name="B" type="number" step="any" min="0" max="180" inputmode="decimal" />

              <label for="angle-c">Angle C (deg)</label>
              <input id="angle-c" name="C" type="number" step="any" min="0" max="180" inputmode="decimal" />
            </div>
            <div class="lesson-links">
              <button type="submit" class="solver-btn">Solve Triangle</button>
              <button type="button" id="triangle-clear" class="solver-btn secondary">Clear</button>
            </div>
          </form>
          <div id="triangle-result" class="triangle-result" aria-live="polite">
            Enter values and click "Solve Triangle."
          </div>
        </article>
      </section>
    </main>
    <script>
      (function () {
        const form = document.getElementById("triangle-solver-form");
        const clearBtn = document.getElementById("triangle-clear");
        const resultEl = document.getElementById("triangle-result");
        const sideKeys = ["a", "b", "c"];
        const angleKeys = ["A", "B", "C"];
        const EPS = 1e-8;

        function toRad(deg) {
          return (deg * Math.PI) / 180;
        }

        function toDeg(rad) {
          return (rad * 180) / Math.PI;
        }

        function round3(value) {
          return Math.round(value * 1000) / 1000;
        }

        function clamp(x) {
          return Math.max(-1, Math.min(1, x));
        }

        function parseValue(v) {
          if (v === "" || v == null) return null;
          const n = Number(v);
          return Number.isFinite(n) ? n : null;
        }

        function findKnownIndexes(arr) {
          const out = [];
          for (let i = 0; i < arr.length; i += 1) {
            if (arr[i] != null) out.push(i);
          }
          return out;
        }

        function validateInput(sides, angles) {
          const knownSides = findKnownIndexes(sides);
          const knownAngles = findKnownIndexes(angles);
          const knownTotal = knownSides.length + knownAngles.length;

          if (knownTotal !== 3) {
            return "Enter exactly 3 known values total.";
          }
          if (knownSides.length < 1) {
            return "At least one known value must be a side.";
          }
          for (const idx of knownSides) {
            if (sides[idx] <= 0) return "Side lengths must be positive.";
          }
          for (const idx of knownAngles) {
            if (angles[idx] <= 0 || angles[idx] >= 180) {
              return "Each known angle must be between 0 and 180 degrees.";
            }
          }
          if (knownAngles.length >= 2) {
            const sum = knownAngles.reduce((acc, i) => acc + angles[i], 0);
            if (sum >= 180 - EPS) return "Known angles must sum to less than 180 degrees.";
          }
          return null;
        }

        function solveSSS(sides) {
          const [a, b, c] = sides;
          if (a + b <= c || a + c <= b || b + c <= a) return [];

          const A = toDeg(Math.acos(clamp((b * b + c * c - a * a) / (2 * b * c))));
          const B = toDeg(Math.acos(clamp((a * a + c * c - b * b) / (2 * a * c))));
          const C = 180 - A - B;

          return [{ method: "Law of Cosines (SSS)", condition: "SSS", sides: [a, b, c], angles: [A, B, C] }];
        }

        function solveAASorASA(sides, angles) {
          const s = sides.slice();
          const A = angles.slice();
          const knownAngles = findKnownIndexes(A);
          const knownSide = findKnownIndexes(s)[0];
          const missingAngle = [0, 1, 2].find((i) => A[i] == null);
          A[missingAngle] = 180 - (A[knownAngles[0]] + A[knownAngles[1]]);
          const ratio = s[knownSide] / Math.sin(toRad(A[knownSide]));
          for (let i = 0; i < 3; i += 1) {
            if (s[i] == null) s[i] = ratio * Math.sin(toRad(A[i]));
          }
          return [{ method: "Law of Sines (ASA/AAS)", condition: "ASA/AAS", sides: s, angles: A }];
        }

        function solveSAS(sides, angles, angleIdx) {
          const s = sides.slice();
          const A = angles.slice();
          const knownSides = findKnownIndexes(s);
          const i = knownSides[0];
          const j = knownSides[1];
          const k = angleIdx;
          s[k] = Math.sqrt(s[i] * s[i] + s[j] * s[j] - 2 * s[i] * s[j] * Math.cos(toRad(A[k])));
          if (s[k] <= 0) return [];
          A[i] = toDeg(Math.acos(clamp((s[j] * s[j] + s[k] * s[k] - s[i] * s[i]) / (2 * s[j] * s[k]))));
          A[j] = 180 - A[k] - A[i];
          if (A[j] <= 0) return [];
          return [{
            method: "Law of Cosines (SAS)",
            condition: "SAS",
            includedAngleIdx: k,
            includedSides: [i, j],
            sides: s,
            angles: A
          }];
        }

        function solveSSA(sides, angles, angleIdx) {
          const s = sides.slice();
          const A = angles.slice();
          const knownSides = findKnownIndexes(s);
          const i = angleIdx;
          const j = knownSides.find((idx) => idx !== i);
          const k = [0, 1, 2].find((idx) => idx !== i && idx !== j);
          const sinJ = (s[j] * Math.sin(toRad(A[i]))) / s[i];
          if (sinJ > 1 + EPS) return [];

          const out = [];
          const angleOptions = [];
          if (Math.abs(sinJ - 1) <= EPS) {
            angleOptions.push(90);
          } else if (sinJ > 0) {
            const base = toDeg(Math.asin(sinJ));
            angleOptions.push(base);
            angleOptions.push(180 - base);
          }

          for (const jAngle of angleOptions) {
            const curA = A.slice();
            const curS = s.slice();
            curA[j] = jAngle;
            curA[k] = 180 - curA[i] - curA[j];
            if (curA[k] <= EPS) continue;
            curS[k] = (curS[i] * Math.sin(toRad(curA[k]))) / Math.sin(toRad(curA[i]));
            if (curS[k] <= EPS) continue;
            out.push({ method: "Law of Sines (SSA)", condition: "SSA", sides: curS, angles: curA });
          }

          return out;
        }

        function solveTriangle(sides, angles) {
          const knownSides = findKnownIndexes(sides);
          const knownAngles = findKnownIndexes(angles);

          if (knownSides.length === 3) return solveSSS(sides);
          if (knownSides.length === 1 && knownAngles.length === 2) return solveAASorASA(sides, angles);
          if (knownSides.length === 2 && knownAngles.length === 1) {
            const angleIdx = knownAngles[0];
            const isSSA = knownSides.includes(angleIdx);
            return isSSA ? solveSSA(sides, angles, angleIdx) : solveSAS(sides, angles, angleIdx);
          }
          return [];
        }

        function renderSolution(solution, idx) {
          const diagram = renderTriangleDiagram(solution);
          const solveFormula = getSolveFormula(solution);
          const areaDetails = getAreaDetails(solution);
          return `
            <div class="triangle-solution">
              <p class="triangle-method">Solution ${idx + 1}: ${solution.method}</p>
              <p class="triangle-values"><strong>Solve formula:</strong> ${solveFormula}</p>
              ${diagram}
              <p class="triangle-values">
                a = ${round3(solution.sides[0])}, b = ${round3(solution.sides[1])}, c = ${round3(solution.sides[2])}
              </p>
              <p class="triangle-values">
                A = ${round3(solution.angles[0])}deg, B = ${round3(solution.angles[1])}deg, C = ${round3(solution.angles[2])}deg
              </p>
              <p class="triangle-values"><strong>Area formula:</strong> <span class="math-eq">${areaDetails.formula}</span></p>
              <p class="triangle-values"><strong>Area:</strong> ${round3(areaDetails.area)}</p>
            </div>
          `;
        }

        function getSolveFormula(solution) {
          if (solution.condition === "SSS") {
            return '<span class="math-eq">a<sup>2</sup> = b<sup>2</sup> + c<sup>2</sup> - 2bc cos(A)</span> (Law of Cosines)';
          }
          if (solution.condition === "SAS") {
            const i = solution.includedSides[0];
            const j = solution.includedSides[1];
            const k = solution.includedAngleIdx;
            return `<span class="math-eq">${sideKeys[k]}<sup>2</sup> = ${sideKeys[i]}<sup>2</sup> + ${sideKeys[j]}<sup>2</sup> - 2(${sideKeys[i]})(${sideKeys[j]}) cos(${angleKeys[k]})</span> (Law of Cosines)`;
          }
          if (solution.condition === "SSA") {
            return '<span class="math-eq"><span class="frac"><span class="num">sin(B)</span><span class="den">b</span></span> = <span class="frac"><span class="num">sin(A)</span><span class="den">a</span></span></span> (Law of Sines; possible ambiguous case)';
          }
          return '<span class="math-eq"><span class="frac"><span class="num">a</span><span class="den">sin(A)</span></span> = <span class="frac"><span class="num">b</span><span class="den">sin(B)</span></span> = <span class="frac"><span class="num">c</span><span class="den">sin(C)</span></span></span> (Law of Sines)';
        }

        function getHeronArea(sides) {
          const [a, b, c] = sides;
          const s = (a + b + c) / 2;
          const areaSq = Math.max(0, s * (s - a) * (s - b) * (s - c));
          return Math.sqrt(areaSq);
        }

        function getAreaDetails(solution) {
          const sides = solution.sides;
          const angles = solution.angles;

          if (solution.condition === "SSS") {
            const s = (sides[0] + sides[1] + sides[2]) / 2;
            const area = getHeronArea(sides);
            return {
              area,
              formula: `K = &radic;(s(s-a)(s-b)(s-c)), s = ${round3(s)}`
            };
          }

          if (solution.condition === "SAS" && solution.includedSides && solution.includedAngleIdx != null) {
            const i = solution.includedSides[0];
            const j = solution.includedSides[1];
            const k = solution.includedAngleIdx;
            const area = 0.5 * sides[i] * sides[j] * Math.sin(toRad(angles[k]));
            return {
              area,
              formula: `K = <span class="frac"><span class="num">1</span><span class="den">2</span></span>(${sideKeys[i]})(${sideKeys[j]}) sin(${angleKeys[k]})`
            };
          }

          const area = 0.5 * sides[1] * sides[2] * Math.sin(toRad(angles[0]));
          return {
            area,
            formula: "K = <span class=\"frac\"><span class=\"num\">1</span><span class=\"den\">2</span></span>bc sin(A)"
          };
        }

        function renderTriangleDiagram(solution) {
          const [a, b, c] = solution.sides;
          if (c <= EPS) return "";

          const ax = 0;
          const ay = 0;
          const bx = c;
          const by = 0;
          const cx = (b * b + c * c - a * a) / (2 * c);
          const cySq = Math.max(0, b * b - cx * cx);
          const cy = Math.sqrt(cySq);

          const pts = [
            { x: ax, y: ay, v: "A" },
            { x: bx, y: by, v: "B" },
            { x: cx, y: cy, v: "C" },
          ];

          const minX = Math.min(...pts.map((p) => p.x));
          const maxX = Math.max(...pts.map((p) => p.x));
          const minY = Math.min(...pts.map((p) => p.y));
          const maxY = Math.max(...pts.map((p) => p.y));
          const width = Math.max(1, maxX - minX);
          const height = Math.max(1, maxY - minY);

          const svgW = 320;
          const svgH = 220;
          const pad = 24;
          const scale = Math.min((svgW - 2 * pad) / width, (svgH - 2 * pad) / height);

          function sx(x) {
            return pad + (x - minX) * scale;
          }
          function sy(y) {
            return svgH - pad - (y - minY) * scale;
          }

          const A = { x: sx(ax), y: sy(ay) };
          const B = { x: sx(bx), y: sy(by) };
          const C = { x: sx(cx), y: sy(cy) };

          function mid(P, Q) {
            return { x: (P.x + Q.x) / 2, y: (P.y + Q.y) / 2 };
          }

          const ab = mid(A, B); // side c
          const ac = mid(A, C); // side b
          const bc = mid(B, C); // side a

          return `
            <svg class="triangle-diagram" viewBox="0 0 ${svgW} ${svgH}" role="img" aria-label="Triangle diagram">
              <polygon points="${A.x},${A.y} ${B.x},${B.y} ${C.x},${C.y}" />
              <circle cx="${A.x}" cy="${A.y}" r="3"></circle>
              <circle cx="${B.x}" cy="${B.y}" r="3"></circle>
              <circle cx="${C.x}" cy="${C.y}" r="3"></circle>
              <text x="${A.x - 12}" y="${A.y + 16}" class="vertex-label">A</text>
              <text x="${B.x + 8}" y="${B.y + 16}" class="vertex-label">B</text>
              <text x="${C.x + 8}" y="${C.y - 8}" class="vertex-label">C</text>
              <text x="${bc.x + 6}" y="${bc.y - 4}" class="side-label">a</text>
              <text x="${ac.x - 12}" y="${ac.y - 4}" class="side-label">b</text>
              <text x="${ab.x}" y="${ab.y + 16}" class="side-label">c</text>
            </svg>
          `;
        }

        function readInputs() {
          const fd = new FormData(form);
          const sides = sideKeys.map((k) => parseValue(fd.get(k)));
          const angles = angleKeys.map((k) => parseValue(fd.get(k)));
          return { sides, angles };
        }

        form.addEventListener("submit", function (e) {
          e.preventDefault();
          const { sides, angles } = readInputs();
          const err = validateInput(sides, angles);
          if (err) {
            resultEl.innerHTML = `<p class="triangle-error">${err}</p>`;
            return;
          }

          const solutions = solveTriangle(sides, angles);
          if (!solutions.length) {
            resultEl.innerHTML = '<p class="triangle-error">No valid triangle found with the given values.</p>';
            return;
          }

          const ambiguousNote =
            solutions.length > 1
              ? '<p class="course-note">Ambiguous SSA case: two valid triangles were found.</p>'
              : "";

          resultEl.innerHTML = ambiguousNote + solutions.map(renderSolution).join("");
        });

        clearBtn.addEventListener("click", function () {
          form.reset();
          resultEl.textContent = 'Enter values and click "Solve Triangle."';
        });
      })();
    </script>
  </body>
</html>
